<!doctype HTML>
<html>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<script src="js/aframe.min.js"></script>
<script src="js/aframe-ar.js"></script>
<script src="js/build.js">  </script>
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->

<style>
    .container {
        position: relative;
    }

    .topright {
        position: absolute;
        top: 8px;
        right: 16px;
        font-size: 18px;
        z-index: 9999;
    }

    .btn {
        background-color: DodgerBlue;
        /* Blue background */
        border: none;
        /* Remove borders */
        color: white;
        /* White text */
        padding: 12px 16px;
        /* Some padding */
        font-size: 16px;
        /* Set a font size */
        cursor: pointer;
        /* Mouse pointer on hover */
    }

    /* Darker background on mouse-over */
    .btn:hover {
        background-color: RoyalBlue;
    }

    .box {
        border: 4px solid black;
        background-color: lightgray;
        opacity: 0.8;
        width: 300px;
        height: 300px;
        overflow-y: scroll;

    }
</style>

<body style="margin: 0px; overflow: hidden;">
    <script>
        AFRAME.registerComponent('canvas-texture', {
            init: function () {
                this.canvas = document.querySelector("#myCanvas");
                this.canvas.width = 512;
                this.canvas.height = 512;
                this.context = this.canvas.getContext('2d');
                this.x = 200;
                this.y = 100;
                this.dx = 5;
                this.dy = 3;
                this.image = ["texture0.jpg", "texture1.jpg", "texture2.jpg", "texture3.jpg", "texture4.jpg", "texture5.jpg", "texture6.jpg", "texture7.jpg", "texture8.jpg", "texture9.jpg", "texture10.jpg", "texture11.jpg", "texture12.jpg", "texture13.jpg", "texture14.jpg", "texture15.jpg", "texture16.jpg", "texture17.jpg", "texture18.jpg", "texture19.jpg", "texture20.jpg", "texture21.jpg", "texture22.jpg", "texture23.jpg", "texture24.jpg", "texture25.jpg", "texture26.jpg", "texture27.jpg", "texture28.jpg", "texture29.jpg", "texture30.jpg", "texture31.jpg", "texture32.jpg"];
                this.imgSrc = "";
                this.glNo = 0;
                this.dtsum = 0;
            },
            update: function () {
                let material = this.el.getObject3D("mesh").material;
                this.el.getObject3D("mesh").rotation.x = Math.PI / 2
                const chara = new Image();
                chara.src = "images/textures/" + this.image[this.glNo];
                chara.onload = () => {
                    this.context.drawImage(chara, 0, 0);
                    if (!material.map)
                        return;
                    else
                        material.map.needsUpdate = true;
                };
            },
            tick: function (t, dt) {
                this.dtsum += dt;
                if (this.dtsum >= 100) {
                    this.dtsum = 0;
                    if (this.glNo >= this.image.length - 1) {
                        this.glNo = 0;
                    } else {
                        this.glNo += 1;
                    }
                    this.update();
                }
            }
        });
        AFRAME.registerComponent('commentbox', {
            schema: {
                'target': { type: 'selector' },
            },
            init: function () {
                console.log("commentBox init");
                this.dtsum = 0;
            },
            update: function () {
                var div1 = document.createElement("div");
                div1.setAttribute("class", "box");
                console.log("commentBox update");

                fetch("https://6373fcb9716c2e1916557b6d.mockapi.io/messages").then((response) => {
                    return response.json();
                }).then((data) => {
                    data.forEach((message) => {
                        var div2 = document.createElement("div");
                        div2.style.borderBottom = "1px dashed black";
                        div2.setAttribute("class", "message");
                        div2.innerHTML = "<h3>" + message.title + "</h3><p>" + message.message + "</p>";
                        div1.appendChild(div2);
                        var staticDiv = document.getElementById("staticComments")
                        staticDiv.appendChild(div1);
                        staticDiv.textContent = "";
                        console.log(staticDiv);
                    });
                    //getFirstElementOf this.el
                    this.el.innerHTML = "";
                    this.el.appendChild(div1);
                });
                if (div1.childElementCount == 0) {
                    var div2 = document.createElement("div");
                    
                    div2.innerHTML = "<h3>Não existem Comentários</h3>";
                }

            },
            tick: function (t, dt) {
                this.dtsum += dt;
                if (this.dtsum >= 10000) {
                    this.dtsum = 0;
                    this.update();
                }
            }

        });
    </script>

    <a-scene embedded vr-mode-ui="enabled: false;" arjs="debugUIEnabled: false;">
        <a-assets>
            <canvas id="myCanvas"></canvas>
        </a-assets>
        <a-marker type="pattern" url="data/hiro.patt">
            <a-cylinder position="0 0.5 0" radius="0.5" material="src: #myCanvas; transparent: true; opacity: 0.95;"
                canvas-texture>
            </a-cylinder>
            <a-cone rotation="90 0 0" position="0 0.5 0.75" radius="0.5" scale="0.5 0.5 0.5" material="opacity: 0.95;">
            </a-cone>
            <a-circle position="0 0.5 0.508" radius="0.5"></a-circle>
            <a-circle rotation="0 180 0" position="0 0.5 -0.508" radius="0.5"></a-circle>
            <!-- PERNAS -->
            <a-box position="0.4 0.9 1" radius="0.5" scale="0.125 0.125 1"></a-box>
            <a-box position="-0.4 0.9 1" radius="0.5" scale="0.125 0.125 1"></a-box>
            <a-box position="0.4 0.2 1" radius="0.5" scale="0.125 0.125 1"></a-box>
            <a-box position="-0.4 0.2 1" radius="0.5" scale="0.125 0.125 1"></a-box>
            <!-- BASE -->
            <a-box rotation="0 0 90" position="0 0.57 0.56" radius="0.5" scale="0.8 0.93 0.125"></a-box>

            <a-entity htmlembed commentbox scale="1 1 1" position="1.2 0.5 -0.7" rotation="270 0 0">
           
            </a-entity>



        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
    <div id="staticComments" class="topright">
        <button class="btn" onclick="">Afixar</button>
    </div>

</body>

</html>